<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>–¢—Ä–µ–Ω–∞–∂—ë—Ä: —É—á–∏–º—Å—è –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤—Ä–µ–º—è –ø–æ —á–∞—Å–∞–º (–∞–Ω–∞–ª–æ–≥–æ–≤—ã–µ —á–∞—Å—ã –¥–ª—è –¥–µ—Ç–µ–π)</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      h1 {
        text-align: center;
        display: inline-block;
        margin: 0 auto;
        vertical-align: middle;
      }
      .header-row {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr auto auto;
        align-items: center;
        margin-bottom: 20px;
        gap: 0 8px;
      }
      .header-row h1 {
        justify-self: center;
        margin: 0;
        grid-column: 1 / 2;
      }
      #settingsBtn, #printBtn {
        justify-self: end;
        margin: 0;
        display: inline-block;
        vertical-align: middle;
        font-size: 28px;
        background: none;
        border: none;
        cursor: pointer;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }
      td {
        width: 33.33%;
        padding: 20px;
        text-align: center;
        vertical-align: top;
      }
      .time-label {
        margin-top: 10px;
        font-size: 18px;
      }
      svg {
        width: 180px;
        height: 180px;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: white;
        padding: 20px;
        border-radius: 5px;
        max-width: 400px;
        width: 90%;
      }
      .modal-content label {
        display: block;
        margin-top: 10px;
      }
      @media print {
        .header-row button {
          display: none !important;
        }
        body {
          margin: 0;
          padding: 0;
          width: 210mm;
          height: 297mm;
          box-sizing: border-box;
        }
        html, body {
          width: 210mm;
          height: 297mm;
          min-width: 0;
          min-height: 0;
          max-width: 210mm;
          max-height: 297mm;
        }
        table {
          width: 100%;
          page-break-inside: avoid;
        }
        td {
          padding: 8px;
        }
        .modal, #settingsModal {
          display: none !important;
        }
        @page {
          size: A4 portrait;
          margin: 10mm;
        }
      }
    </style>
  </head>
  <body>
    <div class="header-row">
      <h1>–£—á–∏–º—Å—è –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤—Ä–µ–º—è –ø–æ —á–∞—Å–∞–º</h1>
      <button id="settingsBtn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
      <button id="printBtn" title="–ü–µ—á–∞—Ç—å" aria-label="–ü–µ—á–∞—Ç—å">üñ®Ô∏è</button>
    </div>
    <table id="clock-table"></table>

    <!-- SVG —à–∞–±–ª–æ–Ω -->
    <template id="clock-template">
      <svg viewBox="0 0 200 200">
        <circle cx="100" cy="100" r="95" stroke="black" stroke-width="2" fill="white" />
        <g font-size="16" font-family="Arial" text-anchor="middle" dominant-baseline="middle">
          <text x="100" y="20" transform="rotate(0,100,100)">12</text>
          <text x="100" y="20" transform="rotate(30,100,100)">1</text>
          <text x="100" y="20" transform="rotate(60,100,100)">2</text>
          <text x="100" y="20" transform="rotate(90,100,100)">3</text>
          <text x="100" y="20" transform="rotate(120,100,100)">4</text>
          <text x="100" y="20" transform="rotate(150,100,100)">5</text>
          <text x="100" y="20" transform="rotate(180,100,100)">6</text>
          <text x="100" y="20" transform="rotate(210,100,100)">7</text>
          <text x="100" y="20" transform="rotate(240,100,100)">8</text>
          <text x="100" y="20" transform="rotate(270,100,100)">9</text>
          <text x="100" y="20" transform="rotate(300,100,100)">10</text>
          <text x="100" y="20" transform="rotate(330,100,100)">11</text>
        </g>
        <g class="twentyfour-group" font-size="13" font-family="Arial" text-anchor="middle" dominant-baseline="middle">
          <text x="100" y="35" transform="rotate(0,100,100)">00</text>
          <text x="100" y="35" transform="rotate(30,100,100)">13</text>
          <text x="100" y="35" transform="rotate(60,100,100)">14</text>
          <text x="100" y="35" transform="rotate(90,100,100)">15</text>
          <text x="100" y="35" transform="rotate(120,100,100)">16</text>
          <text x="100" y="35" transform="rotate(150,100,100)">17</text>
          <text x="100" y="35" transform="rotate(180,100,100)">18</text>
          <text x="100" y="35" transform="rotate(210,100,100)">19</text>
          <text x="100" y="35" transform="rotate(240,100,100)">20</text>
          <text x="100" y="35" transform="rotate(270,100,100)">21</text>
          <text x="100" y="35" transform="rotate(300,100,100)">22</text>
          <text x="100" y="35" transform="rotate(330,100,100)">23</text>
        </g>
        <circle cx="100" cy="100" r="3" fill="black" />
      </svg>
    </template>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal" id="settingsModal">
      <div class="modal-content">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        <label>
          –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞:
          <input type="time" id="startTime" />
        </label>
        <label>
          –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞:
          <input type="time" id="endTime" />
        </label>
        <label>
          –®–∞–≥ –≤—Ä–µ–º–µ–Ω–∏:
          <select id="step">
            <option value="30">–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω</option>
            <option value="15">–ö–∞–∂–¥—ã–µ 15 –º–∏–Ω</option>
            <option value="10">–ö–∞–∂–¥—ã–µ 10 –º–∏–Ω</option>
            <option value="random">–°–ª—É—á–∞–π–Ω–æ</option>
          </select>
        </label>
        <label>
          <input type="checkbox" id="showDigital" />
          –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ü–∏—Ñ—Ä–æ–≤–æ–µ –≤—Ä–µ–º—è
        </label>
        <label>
          <input type="checkbox" id="showAnalog" checked />
          –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ —á–∞—Å–∞—Ö
        </label>
        <label>
          <input type="checkbox" id="twentyFourClock" />
          24-—á–∞—Å–æ–≤–æ–π —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç
        </label>
        <label>
          <input type="checkbox" id="ampmMode" />
          12-—á–∞—Å–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç (AM/PM)
        </label>
        <button onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>

    <script>
      function openModal() {
        document.getElementById('settingsModal').style.display = 'flex';
      }
      function closeModal() {
        document.getElementById('settingsModal').style.display = 'none';
        generateClocks();
      }

      document.getElementById('settingsBtn').onclick = openModal;
      document.getElementById('printBtn').onclick = function() { window.print(); };

      function saveSettings() {
        const settings = {
          start: document.getElementById('startTime').value || '00:00',
          end: document.getElementById('endTime').value || '23:59',
          step: document.getElementById('step').value,
          showDigital: document.getElementById('showDigital').checked,
          showAnalog: document.getElementById('showAnalog').checked,
          twentyFourClock: document.getElementById('twentyFourClock').checked,
          ampmMode: document.getElementById('ampmMode').checked,
        };
        sessionStorage.setItem('clockSettings', JSON.stringify(settings));
        closeModal();
        generateClocks();
      }

      function loadSettings() {
        const defaults = {
          start: '00:00',
          end: '23:59',
          step: '30',
          showDigital: false,
          showAnalog: true,
          twentyFourClock: false,
          ampmMode: false,
        };
        const saved = JSON.parse(sessionStorage.getItem('clockSettings')) || defaults;
        document.getElementById('startTime').value = saved.start;
        document.getElementById('endTime').value = saved.end;
        document.getElementById('step').value = saved.step;
        document.getElementById('showDigital').checked = saved.showDigital;
        if (document.getElementById('showAnalog'))
          document.getElementById('showAnalog').checked = saved.showAnalog !== false;
        if (document.getElementById('twentyFourClock'))
          document.getElementById('twentyFourClock').checked = saved.twentyFourClock === true;
        if (document.getElementById('ampmMode'))
          document.getElementById('ampmMode').checked = saved.ampmMode === true;
        return saved;
      }

      function generateClocks() {
        const { start, end, step, showDigital, twentyFourClock, ampmMode } = loadSettings();
        const showAnalog = document.getElementById('showAnalog') ? document.getElementById('showAnalog').checked : true;
        const startMinutes = toMinutes(start);
        const endMinutes = toMinutes(end);
        const stepVal = step === 'random' ? 1 : parseInt(step); // 1 –º–∏–Ω—É—Ç–∞ –¥–ª—è random
        let times = [];
        const count = 12;
        const maxAttempts = 1000;
        let attempts = 0;
        const uniqueTimes = new Set();

        // Helper to round down to nearest step
        function roundToStep(mins, step) {
          return mins - (mins % step);
        }

        // Generate all possible valid times in the interval, rounded to step
        let possibleTimes = [];
        if (step !== 'random') {
          for (let t = roundToStep(startMinutes, stepVal); t <= endMinutes; t += stepVal) {
            if (t >= startMinutes && t <= endMinutes) {
              possibleTimes.push(minutesToTime(t));
            }
          }
        }

        if (step === 'random') {
          // Randomly pick unique raw times (no rounding!) from the interval
          while (uniqueTimes.size < Math.min(count, endMinutes - startMinutes + 1) && attempts < maxAttempts) {
            const rnd = startMinutes + Math.floor(Math.random() * (endMinutes - startMinutes + 1));
            uniqueTimes.add(minutesToTime(rnd));
            attempts++;
          }
          times = Array.from(uniqueTimes);
          // If not enough, fill with more random (may repeat)
          while (times.length < count && attempts < maxAttempts) {
            const rnd = startMinutes + Math.floor(Math.random() * (endMinutes - startMinutes + 1));
            times.push(minutesToTime(rnd));
            attempts++;
          }
        } else {
          // For non-random, just shuffle possibleTimes and take up to count
          possibleTimes = possibleTimes.sort(() => Math.random() - 0.5);
          times = possibleTimes.slice(0, count);
          // If not enough, fill with more random (may repeat)
          while (times.length < count && attempts < maxAttempts) {
            const rnd = startMinutes + Math.floor(Math.random() * (endMinutes - startMinutes + 1));
            const rounded = roundToStep(rnd, stepVal);
            if (rounded >= startMinutes && rounded <= endMinutes) {
              times.push(minutesToTime(rounded));
            }
            attempts++;
          }
        }

        times = times.slice(0, count);
        const table = document.getElementById('clock-table');
        table.innerHTML = '';
        const template = document.getElementById('clock-template');

        for (let i = 0; i < times.length; i += 3) {
          const row = document.createElement('tr');
          for (let j = 0; j < 3; j++) {
            const cell = document.createElement('td');
            const svgFragment = template.content.cloneNode(true);
            const svg = svgFragment.querySelector('svg');
            if (showAnalog && times[i + j]) {
              // draw hands
              const [h, m] = times[i + j].split(':').map(Number);
              // hour hand
              const hourAngle = ((h % 12) + m / 60) * 30;
              const hourX = 100 + 40 * Math.sin((Math.PI / 180) * hourAngle);
              const hourY = 100 - 40 * Math.cos((Math.PI / 180) * hourAngle);
              const hourHand = document.createElementNS('http://www.w3.org/2000/svg', 'line');
              hourHand.setAttribute('x1', '100');
              hourHand.setAttribute('y1', '100');
              hourHand.setAttribute('x2', hourX.toString());
              hourHand.setAttribute('y2', hourY.toString());
              hourHand.setAttribute('stroke', 'black');
              hourHand.setAttribute('stroke-width', '5');
              hourHand.setAttribute('stroke-linecap', 'round');
              svg.appendChild(hourHand);
              // minute hand
              const minAngle = m * 6;
              const minX = 100 + 70 * Math.sin((Math.PI / 180) * minAngle);
              const minY = 100 - 70 * Math.cos((Math.PI / 180) * minAngle);
              const minHand = document.createElementNS('http://www.w3.org/2000/svg', 'line');
              minHand.setAttribute('x1', '100');
              minHand.setAttribute('y1', '100');
              minHand.setAttribute('x2', minX.toString());
              minHand.setAttribute('y2', minY.toString());
              minHand.setAttribute('stroke', 'black');
              minHand.setAttribute('stroke-width', '3');
              minHand.setAttribute('stroke-linecap', 'round');
              svg.appendChild(minHand);
            }
            // –°–∫—Ä—ã—Ç–∏–µ/–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ 24—á —Ü–∏—Ñ—Ä
            const tfGroup = svg.querySelector('.twentyfour-group');
            if (tfGroup) tfGroup.style.display = twentyFourClock ? '' : 'none';
            cell.appendChild(svgFragment);
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'time-label';
            input.style.display = 'block';
            input.style.margin = '10px auto 0 auto';
            input.style.width = '120px';
            input.style.height = '35px';
            input.style.fontSize = '25px';
            input.style.borderRadius = '6px';
            input.style.border = '2px solid #888';
            input.style.textAlign = 'center';
            let placeholder = '___:___';
            if (showDigital && times[i + j]) {
              if (ampmMode) {
                // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ 12-—á–∞—Å–æ–≤–æ–π —Å AM/PM
                const [h, m] = times[i + j].split(':').map(Number);
                let hour = h % 12;
                if (hour === 0) hour = 12;
                const ampm = h < 12 ? 'AM' : 'PM';
                placeholder = `${hour.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')} ${ampm}`;
              } else {
                placeholder = times[i + j];
              }
            }
            input.placeholder = placeholder;
            cell.appendChild(input);
            row.appendChild(cell);
          }
          table.appendChild(row);
        }
      }

      function toMinutes(t) {
        const [h, m] = t.split(':').map(Number);
        return h * 60 + m;
      }

      function minutesToTime(mins) {
        const h = String(Math.floor(mins / 60)).padStart(2, '0');
        const m = String(mins % 60).padStart(2, '0');
        return `${h}:${m}`;
      }

      // –û—á–∏—â–∞–µ–º sessionStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      window.onload = function() {
        sessionStorage.removeItem('clockSettings');
        generateClocks();
      };
    </script>
  </body>
</html>
